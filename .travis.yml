
language: java
sudo: false
install: true

addons:
  sonarcloud:
    organization: "radixdlt-github"
    token:
      secure: "ZCbrfbFEVGwGGQ3xhh+fqMu1QsnR9jv8cKN4Za/mVLGjDAsf6F6TMeund1NbGxCOHhL1FurQKRra2vGZaIWPRMW0pDQouKnbkRgJWy7BGWbj0vXU/yAvgPKlMAmFSC19M6erzRGFCz24a3C00HPfK1PTxpK6OSO1Ok8eEBium5WdFlgpxcXPM3IoGIdnqzXv6kYOeLdX42Lxn7WUjEzpKz7xy6Dr1rAmssDxxvL6V00xaLuUCyB1krZL6Tsn+plpgkH6qShQay5Cr43V4ac9yekxkUkiGZ9vrai9A4VJJn39X4ydImIb5pohX8B+nJk6qkCPvb2D1nG0t0VcxK9n2G7InZycW6PYGqJFYHoE/lzCR9di6jKAwaAeVr5wDvTA7LEBifhoVikSsEKuTX3MYFqJRAPTqW1UDrKAQ7q4yGPs3yyF2nwJLV95C7p0oXg/Tsp7yLXC756S2sSHew1R163M10h+Uu9KeZBbofC+JCw6KjwpeDAc36XhXZq8rRAMt8kfdaJvN3SD2yFo8OwUmE2RJAv6mHMQjc+kCEvU2g86Niy4z6g6XoesgHeHmcuXwbTPwoWr0/VVmF70R99JC9w3LdDxGvoM16RZVeAbLADXbFBW3XmB4KPxIfbcfT4jMHEz8s07P0WCZ6wJhjOkpWloGAYyOwAG7aiJTYZoOQU="

jdk:
  - openjdk11

git:
  depth: false

jobs:
  include:
    - stage: check
      script: ./gradlew check jacocoTestReport sonarqube --info --refresh-dependencies
    - stage: integration
      script: ./gradlew integrationTest --refresh-dependencies

before_cache:
  - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -fr $HOME/.gradle/caches/*/plugin-resolution/

cache:
  directories:
    - '$HOME/.m2/repository'
    - '$HOME/.sonar/cache'
    - '$HOME/.gradle'
    - '.gradle'

env:
  - TEST_DURATION=30s
