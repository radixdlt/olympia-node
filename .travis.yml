language: java
sudo: false
install: true

addons:
  sonarcloud:
    organization: "radixdlt-github"
    token:
      secure: "K3M7B8rp0TMaPiX/jhGQXAkDZVR9apoc/a9sgv9ya7m4VSdRtBPTfKui3hvHWmmfbRsaKdh2wGizOGkPA8qKl8FskZEZP6+YKPWEc1SG6XCPOgBBH9r/n0pQXfnhPzfKzcA5sixT3VATF8mcO92OMlyTo8cTOS/HxcxllEs4kA4GOIz4+mIw5IwtPTOzUPBAJywe59ZGjL+XTYwFicACn7Ba93kj2S3gkyJOnZaLAZYysRDgPWgL9bgnsecafqNy079/nwNmXzr1mofKaFwXGE9/Wtpw8yAUEInUF8oIUqbC/ox47jAru2Bf/X+F5SiJwod9D7diRFopQA1IWAY9CR9OBHNf04ywGyi9w/sAjbrCunduP4bXJj/fSZXgbZE75szuPCuBLv6nHjWxNg/L/uOZ/7WSJrcEFZLQo79OvDcBV7uIUuIzM54fJHKAHzDh17rq6VONKXn2BXi8ROhP7q1pB3JFghRCG4/3bfBeuDyuCKL2+4U9E3iBr/9riHnJ1iCej3qSLHXWaO+UuFAoFhm4IASBJMrboJzismKl+foIY539NmgKE7ESxVU/1cUiU9kzSo8mPg8qrptvhoa535CfkpNCtByLGvAj9eu0A6tC8TIhOOmVVrpNNTIuj8WtJDd/hqovf5Ln6u/BUF24AgD/1XktcRJIZBHHykVWkJE="

jdk:
  - openjdk11

git:
  depth: false

jobs:
  include:
jobs:
  include:
    - stage: check
      script: ./gradlew check --info
    - stage: sonar
      script: ./gradlew jacocoTestReport sonarqube --info
    - stage: integration
      script: ./gradlew integrationTest --refresh-dependencies

before_cache:
  - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -fr $HOME/.gradle/caches/*/plugin-resolution/

cache:
  directories:
    - '$HOME/.m2/repository'
    - '$HOME/.sonar/cache'
    - '$HOME/.gradle'
    - '.gradle'

env:
  - TEST_DURATION=30s
